
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/SDK/bcx/bcxAdapter.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '97258OmOcZEJIes7LV/pGyQ', 'bcxAdapter');
// SDK/bcx/bcxAdapter.js

"use strict";

// import BCX from 'bcx.min.js' 
require('./core.min');

require('./plugins.min'); //cocos配置


var _configParams = {
  ws_node_list: [{
    url: "ws://39.106.126.54:8049",
    name: "COCOS3.0节点2"
  }],
  networks: [{
    core_asset: "COCOS",
    chain_id: '7d89b84f22af0b150780a2b121aa6c715b19261c8b7fe0fda3a564574ed7d3e9'
  }],
  faucetUrl: 'http://47.93.62.96:8041',
  auto_reconnect: true,
  worker: false,
  real_sub: true,
  check_cached_nodes_data: true
};
var BCXAdpater = cc.Class({
  // onLoad () {},
  start: function start() {//console.info("window=1=",window.BcxWeb);
  },
  initSDK: function initSDK(callback) {
    this.contractName = "contract.starproject"; //合约名称

    if (window.BcxWeb) {
      this.bcl = window.BcxWeb;
      console.log("===bcl---");

      if (callback) {
        callback(true);
      }
    } else {
      console.log("===bcl--cocos-");
      var self = this;
      self.bcl = new BCX(_configParams);
      Cocosjs.plugins(new CocosBCX()); //connect pc-plugin between sdk

      Cocosjs.cocos.connect('My-App').then(function (connected) {
        console.log("connected==" + connected);

        if (!connected) {
          //检测一下注入
          self.checkWindowBcx(function (is_success) {
            console.log("is_success==", is_success);

            if (is_success) {
              if (callback) {
                console.log("is_success==222");
                callback(true);
              }
            } else {
              console.log("no_cocos_pay");
              callback(false);
            }
          });
          return false;
        } //此时走的是coocspay客户端


        var cocos = Cocosjs.cocos;
        self.bcl = cocos.cocosBcx(self.bcl);

        if (self.bcl) {
          if (callback) {
            callback(true);
          }
        } else {
          if (callback) {
            callback(null);
          }
        }
      })["catch"](function (e) {
        console.log("connect error---" + JSON.stringify(e));
      });
    }
  },
  checkWindowBcx: function checkWindowBcx(callback) {
    //目前进来的时候可能还没有吧bcx挂在window 需要个定时器
    var check_count = 0;
    var self = this;
    var sdk_intervral = setInterval(function () {
      console.log("checkWindowBcx", window.BcxWeb);

      if (window.BcxWeb) {
        self.bcl = window.BcxWeb;

        if (callback) {
          callback(true);
        }

        clearInterval(sdk_intervral);
      }

      if (check_count >= 3) {
        clearInterval(sdk_intervral);

        if (callback) {
          callback(false);
        }
      }

      check_count = check_count + 1;
    }, 1000);
  },
  login: function login(callback) {
    var _this = this;

    if (this.bcl) {
      try {
        console.log("login===adada=");
        this.bcl.getAccountInfo().then(function (res) {
          console.log("res.account_name==" + res.account_name);
          _this.bcl.account_name = res.account_name;

          if (callback) {
            callback(res);
          }
        });
      } catch (e) {
        console.log("login==e====" + e);
        console.log("his.bcl.account_name===" + this.bcl.account_name);

        if (this.bcl.account_name) {
          if (callback) {
            callback(this.bcl.account_name);
          }
        }
      }
    }
  },
  getBalanceByAccount: function getBalanceByAccount(account, callback) {
    this.bcl.queryAccountBalances({
      assetId: 'COCOS',
      account: account
    }).then(function (res) {
      console.info('getBalanceByAccount==', res);

      if (res.code === -25 || res.code === 125) {
        //表示还没有这种代币，先给与赋值为0
        res.code = 1;
        res.data.COCOS = 0;

        if (callback) {
          callback(res);
        }
      }

      if (res.code === 1) {
        if (callback) {
          callback(res);
        }
      } else if (callback) {
        callback(res);
      }
    });
  },
  sendWinCocos: function sendWinCocos(account, stars, callback) {
    this.bcl.callContractFunction({
      nameOrId: this.contractName,
      functionName: 'sendstar',
      valueList: [account, stars] ////

    }).then(function (res) {
      console.info("draw res=", res);

      if (res.code === 1) {
        callback(res);
      } else {
        callback(res);
      }
    })["catch"](function (e) {
      console.info("draw lottery error=", JSON.stringify(e));
    });
  }
});
var bcxAdapter = new BCXAdpater();
bcxAdapter.start();
module.exports = bcxAdapter;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU0RLXFxiY3hcXGJjeEFkYXB0ZXIuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsIl9jb25maWdQYXJhbXMiLCJ3c19ub2RlX2xpc3QiLCJ1cmwiLCJuYW1lIiwibmV0d29ya3MiLCJjb3JlX2Fzc2V0IiwiY2hhaW5faWQiLCJmYXVjZXRVcmwiLCJhdXRvX3JlY29ubmVjdCIsIndvcmtlciIsInJlYWxfc3ViIiwiY2hlY2tfY2FjaGVkX25vZGVzX2RhdGEiLCJCQ1hBZHBhdGVyIiwiY2MiLCJDbGFzcyIsInN0YXJ0IiwiaW5pdFNESyIsImNhbGxiYWNrIiwiY29udHJhY3ROYW1lIiwid2luZG93IiwiQmN4V2ViIiwiYmNsIiwiY29uc29sZSIsImxvZyIsInNlbGYiLCJCQ1giLCJDb2Nvc2pzIiwicGx1Z2lucyIsIkNvY29zQkNYIiwiY29jb3MiLCJjb25uZWN0IiwidGhlbiIsImNvbm5lY3RlZCIsImNoZWNrV2luZG93QmN4IiwiaXNfc3VjY2VzcyIsImNvY29zQmN4IiwiZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJjaGVja19jb3VudCIsInNka19pbnRlcnZyYWwiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiLCJsb2dpbiIsImdldEFjY291bnRJbmZvIiwicmVzIiwiYWNjb3VudF9uYW1lIiwiZ2V0QmFsYW5jZUJ5QWNjb3VudCIsImFjY291bnQiLCJxdWVyeUFjY291bnRCYWxhbmNlcyIsImFzc2V0SWQiLCJpbmZvIiwiY29kZSIsImRhdGEiLCJDT0NPUyIsInNlbmRXaW5Db2NvcyIsInN0YXJzIiwiY2FsbENvbnRyYWN0RnVuY3Rpb24iLCJuYW1lT3JJZCIsImZ1bmN0aW9uTmFtZSIsInZhbHVlTGlzdCIsImJjeEFkYXB0ZXIiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUdBO0FBQ0FBLE9BQU8sQ0FBQyxZQUFELENBQVA7O0FBRUFBLE9BQU8sQ0FBQyxlQUFELENBQVAsRUFFQTs7O0FB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TSxDQUFDQyxPQUFQLEdBQWlCRixVQUFqQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiXG5cblxuLy8gaW1wb3J0IEJDWCBmcm9tICdiY3gubWluLmpzJyBcbnJlcXVpcmUoJy4vY29yZS5taW4nKVxuXG5yZXF1aXJlKCcuL3BsdWdpbnMubWluJylcblxuLy9jb2Nvc+mFjee9rlxudmFyIF9jb25maWdQYXJhbXMgPSB7XG4gICAgd3Nfbm9kZV9saXN0OiBbe1xuICAgICAgICB1cmw6IFwid3M6Ly8zOS4xMDYuMTI2LjU0OjgwNDlcIixcbiAgICAgICAgbmFtZTogXCJDT0NPUzMuMOiKgueCuTJcIlxuICAgIH1dLFxuICAgIG5ldHdvcmtzOiBbe1xuICAgICAgICBjb3JlX2Fzc2V0OiBcIkNPQ09TXCIsXG4gICAgICAgIGNoYWluX2lkOiAnN2Q4OWI4NGYyMmFmMGIxNTA3ODBhMmIxMjFhYTZjNzE1YjE5MjYxYzhiN2ZlMGZkYTNhNTY0NTc0ZWQ3ZDNlOSdcbiAgICB9XSxcbiAgICBmYXVjZXRVcmw6ICdodHRwOi8vNDcuOTMuNjIuOTY6ODA0MScsXG4gICAgYXV0b19yZWNvbm5lY3Q6IHRydWUsXG4gICAgd29ya2VyOiBmYWxzZSxcbiAgICByZWFsX3N1YjogdHJ1ZSxcbiAgICBjaGVja19jYWNoZWRfbm9kZXNfZGF0YTogdHJ1ZSxcbn07XG5cblxuXG5sZXQgQkNYQWRwYXRlciA9IGNjLkNsYXNzKHtcbiAgICAvLyBvbkxvYWQgKCkge30sXG5cbiAgICBzdGFydCAoKSB7XG4gICAgICAgIC8vY29uc29sZS5pbmZvKFwid2luZG93PTE9XCIsd2luZG93LkJjeFdlYik7XG4gICAgfSxcblxuICAgIGluaXRTREsgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgdGhpcy5jb250cmFjdE5hbWUgPSBcImNvbnRyYWN0LnN0YXJwcm9qZWN0XCI7ICAgICAgICAgLy/lkIjnuqblkI3np7BcbiAgICAgICAgICAgIGlmICh3aW5kb3cuQmN4V2ViKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5iY2wgPSAgd2luZG93LkJjeFdlYjtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PWJjbC0tLVwiKVxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PWJjbC0tY29jb3MtXCIpXG4gICAgICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzXG4gICAgICAgICAgICAgICAgc2VsZi5iY2wgPSBuZXcgQkNYKF9jb25maWdQYXJhbXMpO1xuICAgICAgICAgICAgICAgIENvY29zanMucGx1Z2lucyhuZXcgQ29jb3NCQ1goKSlcbiAgICAgICAgICAgICAgICAvL2Nvbm5lY3QgcGMtcGx1Z2luIGJldHdlZW4gc2RrXG4gICAgICAgICAgICAgICAgQ29jb3Nqcy5jb2Nvcy5jb25uZWN0KCdNeS1BcHAnKS50aGVuKGNvbm5lY3RlZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdGVkPT1cIitjb25uZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29ubmVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+ajgOa1i+S4gOS4i+azqOWFpVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGVja1dpbmRvd0JjeChmdW5jdGlvbihpc19zdWNjZXNzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImlzX3N1Y2Nlc3M9PVwiLGlzX3N1Y2Nlc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNfc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJpc19zdWNjZXNzPT0yMjJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJub19jb2Nvc19wYXlcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIC8v5q2k5pe26LWw55qE5pivY29vY3NwYXnlrqLmiLfnq69cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29jb3MgPSBDb2Nvc2pzLmNvY29zXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuYmNsID0gY29jb3MuY29jb3NCY3goc2VsZi5iY2wpO1xuICAgICAgICAgICAgICAgICAgICBpZihzZWxmLmJjbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gIFxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdCBlcnJvci0tLVwiK0pTT04uc3RyaW5naWZ5KGUpKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgXG4gICAgICAgICAgICB9XG4gICAgfSxcblxuXG4gICAgY2hlY2tXaW5kb3dCY3goY2FsbGJhY2spe1xuICAgICAgICAvL+ebruWJjei/m+adpeeahOaXtuWAmeWPr+iDvei/mOayoeacieWQp2JjeOaMguWcqHdpbmRvdyDpnIDopoHkuKrlrprml7blmahcbiAgICAgICAgbGV0IGNoZWNrX2NvdW50ID0gMFxuICAgICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgICAgbGV0IHNka19pbnRlcnZyYWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjaGVja1dpbmRvd0JjeFwiLHdpbmRvdy5CY3hXZWIpXG4gICAgICAgICAgICBpZiAod2luZG93LkJjeFdlYil7XG4gICAgICAgICAgICAgICAgc2VsZi5iY2wgPSB3aW5kb3cuQmN4V2ViXG4gICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0cnVlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHNka19pbnRlcnZyYWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKGNoZWNrX2NvdW50Pj0zKXtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHNka19pbnRlcnZyYWwpO1xuICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKXtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZmFsc2UpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hlY2tfY291bnQgPSBjaGVja19jb3VudCArIDFcblxuICAgICAgICB9LCAxMDAwKTtcbiAgICB9LFxuXG4gICAgbG9naW4oY2FsbGJhY2spe1xuICAgICAgICBpZih0aGlzLmJjbCl7XG4gICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2dpbj09PWFkYWRhPVwiKVxuICAgICAgICAgICAgICAgIHRoaXMuYmNsLmdldEFjY291bnRJbmZvKCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlcy5hY2NvdW50X25hbWU9PVwiK3Jlcy5hY2NvdW50X25hbWUpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYmNsLmFjY291bnRfbmFtZSA9IHJlcy5hY2NvdW50X25hbWUgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfWNhdGNoKGUpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9naW49PWU9PT09XCIrZSlcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImhpcy5iY2wuYWNjb3VudF9uYW1lPT09XCIrdGhpcy5iY2wuYWNjb3VudF9uYW1lKVxuICAgICAgICAgICAgICAgIGlmKHRoaXMuYmNsLmFjY291bnRfbmFtZSl7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5iY2wuYWNjb3VudF9uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldEJhbGFuY2VCeUFjY291bnQgKGFjY291bnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuYmNsLnF1ZXJ5QWNjb3VudEJhbGFuY2VzKHtcbiAgICAgICAgICAgIGFzc2V0SWQ6J0NPQ09TJyxcbiAgICAgICAgICAgIGFjY291bnQ6IGFjY291bnQsXG4gICAgICAgIFxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oJ2dldEJhbGFuY2VCeUFjY291bnQ9PScscmVzKTtcblxuICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAtMjUgfHwgcmVzLmNvZGUgPT09IDEyNSkge1xuICAgICAgICAgICAgICAgIC8v6KGo56S66L+Y5rKh5pyJ6L+Z56eN5Luj5biB77yM5YWI57uZ5LiO6LWL5YC85Li6MFxuICAgICAgICAgICAgICAgIHJlcy5jb2RlID0gMTtcbiAgICAgICAgICAgICAgICByZXMuZGF0YS5DT0NPUyA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzKTtcbiAgICAgICAgICAgIH0gICBcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNlbmRXaW5Db2NvcyhhY2NvdW50LHN0YXJzLGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuYmNsLmNhbGxDb250cmFjdEZ1bmN0aW9uKHtcbiAgICAgICAgICAgIG5hbWVPcklkOiB0aGlzLmNvbnRyYWN0TmFtZSxcbiAgICAgICAgICAgIGZ1bmN0aW9uTmFtZTogJ3NlbmRzdGFyJyxcbiAgICAgICAgICAgIHZhbHVlTGlzdDpbYWNjb3VudCwgc3RhcnNdLC8vLy9cbiAgICAgICAgICAgXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcImRyYXcgcmVzPVwiLHJlcyk7XG5cbiAgICAgICAgICAgIGlmIChyZXMuY29kZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiZHJhdyBsb3R0ZXJ5IGVycm9yPVwiLEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxufSk7XG5cbmxldCBiY3hBZGFwdGVyID0gbmV3IEJDWEFkcGF0ZXIoKTtcbmJjeEFkYXB0ZXIuc3RhcnQoKTtcbm1vZHVsZS5leHBvcnRzID0gYmN4QWRhcHRlcjsiXX0=