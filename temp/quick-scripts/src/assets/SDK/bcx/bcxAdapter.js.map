{"version":3,"sources":["assets\\SDK\\bcx\\bcxAdapter.js"],"names":["require","_configParams","ws_node_list","url","name","networks","core_asset","chain_id","faucetUrl","auto_reconnect","worker","real_sub","check_cached_nodes_data","BCXAdpater","cc","Class","start","initSDK","callback","contractName","window","BcxWeb","bcl","console","log","self","BCX","Cocosjs","plugins","CocosBCX","cocos","connect","then","connected","checkWindowBcx","is_success","cocosBcx","e","JSON","stringify","check_count","sdk_intervral","setInterval","clearInterval","login","getAccountInfo","res","account_name","getBalanceByAccount","account","queryAccountBalances","assetId","info","code","data","COCOS","sendWinCocos","stars","callContractFunction","nameOrId","functionName","valueList","bcxAdapter","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["\n\n\n// import BCX from 'bcx.min.js' \nrequire('./core.min')\n\nrequire('./plugins.min')\n\n//cocos配置\nvar _configParams = {\n    ws_node_list: [{\n        url: \"ws://39.106.126.54:8049\",\n        name: \"COCOS3.0节点2\"\n    }],\n    networks: [{\n        core_asset: \"COCOS\",\n        chain_id: '7d89b84f22af0b150780a2b121aa6c715b19261c8b7fe0fda3a564574ed7d3e9'\n    }],\n    faucetUrl: 'http://47.93.62.96:8041',\n    auto_reconnect: true,\n    worker: false,\n    real_sub: true,\n    check_cached_nodes_data: true,\n};\n\n\n\nlet BCXAdpater = cc.Class({\n    // onLoad () {},\n\n    start () {\n        //console.info(\"window=1=\",window.BcxWeb);\n    },\n\n    initSDK (callback) {\n          this.contractName = \"contract.starproject\";         //合约名称\n            if (window.BcxWeb) {\n                this.bcl =  window.BcxWeb;\n                console.log(\"===bcl---\")\n                if (callback) {\n                    callback(true);\n                }\n            }else{\n                console.log(\"===bcl--cocos-\")\n                let self = this\n                self.bcl = new BCX(_configParams);\n                Cocosjs.plugins(new CocosBCX())\n                //connect pc-plugin between sdk\n                Cocosjs.cocos.connect('My-App').then(connected => {\n                    console.log(\"connected==\"+connected)\n                    if (!connected) {\n                        //检测一下注入\n                        self.checkWindowBcx(function(is_success){\n                            console.log(\"is_success==\",is_success)\n                            if(is_success){\n                                if (callback) {\n                                    console.log(\"is_success==222\")\n                                    callback(true)\n                                }\n                            }else{\n                                console.log(\"no_cocos_pay\")\n                                callback(false)\n                            }\n                        })\n                        return false\n                    }\n    \n                    //此时走的是coocspay客户端\n                    const cocos = Cocosjs.cocos\n                    self.bcl = cocos.cocosBcx(self.bcl);\n                    if(self.bcl){\n                        if (callback) {\n                            callback(true);\n                        }  \n                    }else{\n                        if (callback) {\n                            callback(null);\n                        }\n                    }\n                }).catch(function(e){\n                    console.log(\"connect error---\"+JSON.stringify(e))\n                })\n    \n            }\n    },\n\n\n    checkWindowBcx(callback){\n        //目前进来的时候可能还没有吧bcx挂在window 需要个定时器\n        let check_count = 0\n        let self = this\n        let sdk_intervral = setInterval(function(){\n            console.log(\"checkWindowBcx\",window.BcxWeb)\n            if (window.BcxWeb){\n                self.bcl = window.BcxWeb\n                if(callback){\n                    callback(true)\n                }\n                clearInterval(sdk_intervral);\n            }\n           \n            if(check_count>=3){\n                clearInterval(sdk_intervral);\n                if(callback){\n                    callback(false)\n                }\n            }\n            check_count = check_count + 1\n\n        }, 1000);\n    },\n\n    login(callback){\n        if(this.bcl){\n            try{\n                console.log(\"login===adada=\")\n                this.bcl.getAccountInfo().then(res => {\n                    console.log(\"res.account_name==\"+res.account_name)\n                    this.bcl.account_name = res.account_name           \n                    if (callback) {\n                        callback(res);\n                    }\n                })\n            }catch(e){\n                console.log(\"login==e====\"+e)\n                console.log(\"his.bcl.account_name===\"+this.bcl.account_name)\n                if(this.bcl.account_name){\n                    if (callback) {\n                        callback(this.bcl.account_name);\n                    }\n                }\n            }\n            \n        }\n    },\n\n    getBalanceByAccount (account, callback) {\n        this.bcl.queryAccountBalances({\n            assetId:'COCOS',\n            account: account,\n        \n        }).then(function(res){\n            console.info('getBalanceByAccount==',res);\n\n            if (res.code === -25 || res.code === 125) {\n                //表示还没有这种代币，先给与赋值为0\n                res.code = 1;\n                res.data.COCOS = 0;\n                if (callback) {\n                    callback(res);\n                }\n            }\n\n            if (res.code === 1) {\n                if (callback) {\n                    callback(res);\n                }\n            } else if (callback) {\n                callback(res);\n            }   \n        });\n    },\n\n    sendWinCocos(account,stars,callback) {\n        this.bcl.callContractFunction({\n            nameOrId: this.contractName,\n            functionName: 'sendstar',\n            valueList:[account, stars],////\n           \n        }).then(function(res){\n            console.info(\"draw res=\",res);\n\n            if (res.code === 1) {\n                callback(res);\n            } else {\n                callback(res);\n            }\n        }).catch(function(e){\n            console.info(\"draw lottery error=\",JSON.stringify(e));\n        });\n    },\n\n});\n\nlet bcxAdapter = new BCXAdpater();\nbcxAdapter.start();\nmodule.exports = bcxAdapter;"]}